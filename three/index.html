<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Three</title>

    <style>
        html, body { margin: 0; padding: 0; }
        canvas {
            position: fixed;
            top: 0;
            left: 0;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js"></script>
    <script src="js/orbit.js"></script>
    <script src="js/T.js"></script>
</head>
<body>
    <div id="container"></div>
    <script>

        (function(){

            var world, camera, controls, scene, renderer;

            init();
            render();

            function animate() {
                requestAnimationFrame(animate);
                controls.update();
            }

            function init() {

                world = new T();

                camera = world.camera;
                camera.x(-200).y(500).z(500);

                scene = world.scene;

                renderer = world.renderer;
                renderer.setClearColor('#f2e8e8');

                controls = new THREE.OrbitControls( camera, renderer.domElement );
                controls.damping = 0.5;
    			controls.addEventListener( 'change', render );

                // CUBE
                var cubeGeometry = Box(100, 50, 100),
                    cubeMaterial = Material(),
                    cube = world.mesh(cubeGeometry, cubeMaterial);

                cube.x(110);
                cube.rotation.z = Math.PI * 35 / 180;

                // CYLINDER
                var cylinderGeo = Cylinder(40, 40, 200, 40),
                    cylinder = world.mesh(cylinderGeo);

                cylinder.x(200);

                // PEDESTAL
                var pedestalGeometry = Box(150, 20, 150),
                    pedestalMaterial = Material('lambert', '#9b7'),
                    pedestal = world.mesh(pedestalGeometry, pedestalMaterial);

                // PLANE
                var planeGeometry = Box(600, 1, 600),
                    plane = world.mesh(planeGeometry);
                plane.y(-1);

                var light = world.light('#fff');
                light.target = cube;
                light.position.set(100, 250, 200);

                // ----- resize
                window.addEventListener( 'resize', onWindowResize, false );

                // ----- animate
                animate();
            }

            function render() {
                renderer.render(scene, camera);
            }

            function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

				render();

			}

            function upload() {
                var url = 'http://gentle-stream-4461.herokuapp.com/upload/',
                    canvas = document.getElementsByTagName('canvas')[0],
                    dataURL = canvas.toDataURL().split(',')[1],
                    xhr = new XMLHttpRequest(),
                    data = JSON.stringify({ image: dataURL });

                xhr.open('POST', url, true);
                xhr.onload = function() {
                    console.log(xhr.responseText);
                };
                xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');
                xhr.send(data);
            };

            window.addEventListener('keydown', function(e) {
                if ( e.keyCode === 32 ) upload();
            });

        })();
    </script>
</body>
</html>
